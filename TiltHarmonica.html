<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>TiltHarmonica - „Çπ„Éû„ÉõÂÇæ„Åç„Éè„Éº„É¢„Éã„Ç´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .explanation-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .explanation-section h2 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .explanation-section h3 {
            color: #2d3748;
            margin: 20px 0 10px 0;
            font-size: 1.2rem;
        }

        .explanation-section p {
            margin-bottom: 10px;
            color: #2d3748;
        }

        .explanation-section ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .explanation-section li {
            margin-bottom: 5px;
            color: #2d3748;
        }

        .code-block {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
        }

        .status-section,
        .control-section,
        .instruction-section,
        .action-section,
        .sensor-section {
            margin-bottom: 25px;
        }

        .status-card,
        .control-card,
        .instruction-card,
        .sensor-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-card h3,
        .control-card h3,
        .instruction-card h3,
        .sensor-card h3 {
            margin-bottom: 15px;
            color: #4a5568;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-text {
            font-weight: 500;
            color: #2d3748;
        }

        .status-indicator.ready .status-text {
            color: #38a169;
        }

        .status-indicator.error .status-text {
            color: #e53e3e;
        }

        .info-grid {
            display: grid;
            gap: 12px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .label {
            font-weight: 500;
            color: #4a5568;
        }

        .value {
            font-weight: 600;
            color: #2d3748;
            font-family: 'Courier New', monospace;
        }

        .instructions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .instruction-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .instruction-item .icon {
            font-size: 1.5rem;
            min-width: 30px;
        }

        .instruction-item .text {
            font-weight: 500;
            color: #2d3748;
        }

        .start-button {
            width: 100%;
            padding: 18px;
            font-size: 1.3rem;
            font-weight: 600;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            margin-bottom: 15px;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .start-button:active {
            transform: translateY(0);
        }

        .start-button.playing {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.4);
        }

        .permission-notice {
            text-align: center;
            color: #e53e3e;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .sensor-grid {
            display: grid;
            gap: 10px;
        }

        .sensor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .sensor-label {
            font-weight: 500;
            color: #4a5568;
        }

        .sensor-value {
            font-weight: 600;
            color: #2d3748;
            font-family: 'Courier New', monospace;
            background: #f7fafc;
            padding: 4px 8px;
            border-radius: 4px;
            min-width: 60px;
            text-align: center;
        }

        .warning-box {
            background: #fed7d7;
            border: 1px solid #feb2b2;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #c53030;
        }

        .info-box {
            background: #bee3f8;
            border: 1px solid #90cdf4;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #2b6cb0;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .status-card,
            .control-card,
            .instruction-card,
            .sensor-card,
            .explanation-section {
                padding: 15px;
            }
            
            .start-button {
                padding: 15px;
                font-size: 1.2rem;
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .playing .start-button {
            animation: pulse 2s infinite;
        }

        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            }
            
            .status-card,
            .control-card,
            .instruction-card,
            .sensor-card,
            .explanation-section {
                background: rgba(45, 55, 72, 0.95);
                color: #e2e8f0;
            }
            
            .status-card h3,
            .control-card h3,
            .instruction-card h3,
            .sensor-card h3,
            .explanation-section h2,
            .explanation-section h3 {
                color: #e2e8f0;
            }
            
            .label,
            .sensor-label {
                color: #a0aec0;
            }
            
            .value,
            .sensor-value {
                color: #e2e8f0;
            }
            
            .instruction-item {
                background: #2d3748;
                color: #e2e8f0;
            }
            
            .sensor-value {
                background: #4a5568;
            }
            
            .code-block {
                background: #2d3748;
                color: #e2e8f0;
                border-color: #4a5568;
            }
            
            .explanation-section p,
            .explanation-section li {
                color: #e2e8f0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéµ TiltHarmonica</h1>
            <p class="subtitle">„Çπ„Éû„Éõ„ÇíÂÇæ„Åë„Å¶ÊºîÂ•è„Åó„Çà„ÅÜÔºÅ</p>
        </header>

        <!-- Âãï‰ΩúË™¨Êòé„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="explanation-section">
            <h2>üìñ „Ç¢„Éó„É™„ÅÆÂãï‰Ωú„Å´„Å§„ÅÑ„Å¶</h2>
            
            <h3>üéØ „Ç¢„Éó„É™„ÅÆÁõÆÁöÑ</h3>
            <p>„Åì„ÅÆ„Ç¢„Éó„É™„ÅØ„ÄÅ„Çπ„Éû„Éº„Éà„Éï„Ç©„É≥„ÅÆÂÇæ„Åç„Çª„É≥„Çµ„ÉºÔºà„Ç∏„É£„Ç§„É≠„ÉªÂä†ÈÄüÂ∫¶„Çª„É≥„Çµ„ÉºÔºâ„Çí‰Ωø„Å£„Å¶„ÄÅÁõ¥ÊÑüÁöÑ„Å´Èü≥Èöé„Å®Èü≥Èáè„ÇíÊìç‰Ωú„Åó„Å¶ÊºîÂ•è‰ΩìÈ®ì„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇ</p>
            
            <h3>üîß ÊäÄË°ìÁöÑ„Å™‰ªïÁµÑ„Åø</h3>
            <p><strong>‰ΩøÁî®„Åó„Å¶„ÅÑ„ÇãÊäÄË°ì:</strong></p>
            <ul>
                <li><strong>Web Audio API</strong>: „Éñ„É©„Ç¶„Ç∂„ÅßÈü≥Â£∞„ÇíÁîüÊàê„ÉªÂà∂Âæ°</li>
                <li><strong>DeviceOrientationEvent</strong>: „Çπ„Éû„Éõ„ÅÆÂÇæ„Åç„ÇíÊ§úÁü•</li>
                <li><strong>HTML5/CSS3</strong>: „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Å™UI</li>
                <li><strong>JavaScript ES6+</strong>: „É¢„ÉÄ„É≥„Å™„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞</li>
            </ul>

            <h3>üì± „Çª„É≥„Çµ„Éº„ÅÆÂãï‰ΩúÂéüÁêÜ</h3>
            <p>„Çπ„Éû„Éº„Éà„Éï„Ç©„É≥„Å´„ÅØ‰ª•‰∏ã„ÅÆ„Çª„É≥„Çµ„Éº„ÅåÊê≠Ëºâ„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºö</p>
            <ul>
                <li><strong>GammaËª∏ÔºàÂ∑¶Âè≥ÂÇæ„ÅçÔºâ</strong>: „Çπ„Éû„Éõ„ÇíÂ∑¶Âè≥„Å´ÂÇæ„Åë„Çã„Å®Èü≥Èöé„ÅåÂ§â„Çè„Çä„Åæ„Åô</li>
                <li><strong>BetaËª∏ÔºàÂâçÂæåÂÇæ„ÅçÔºâ</strong>: „Çπ„Éû„Éõ„ÇíÂâçÂæå„Å´ÂÇæ„Åë„Çã„Å®Èü≥Èáè„ÅåÂ§â„Çè„Çä„Åæ„Åô</li>
            </ul>

            <h3>üéº Èü≥Èöé„ÅÆ‰ªïÁµÑ„Åø</h3>
            <p>Èü≥Èöé„ÅØ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´Âà∂Âæ°„Åï„Çå„Åæ„ÅôÔºö</p>
            <div class="code-block">
Èü≥ÈöéÁØÑÂõ≤: C4 (261.63Hz) „Äú C5 (523.25Hz)
Â∑¶Âè≥ÂÇæ„Åç: -45¬∞ „Äú +45¬∞ ‚Üí Èü≥Èöé„Å´Â§âÊèõ
ÂâçÂæåÂÇæ„Åç: -30¬∞ „Äú +30¬∞ ‚Üí Èü≥Èáè„Å´Â§âÊèõÔºà0„Äú80%Ôºâ
            </div>

            <h3>‚ö†Ô∏è ÈáçË¶Å„Å™Ê≥®ÊÑè‰∫ãÈ†Ö</h3>
            <div class="warning-box">
                <strong>Èü≥„ÅåÂá∫„Çã„Ç¢„Éó„É™„Åß„ÅôÔºÅ</strong><br>
                ‚Ä¢ Âë®Âõ≤„ÅÆÁí∞Â¢É„Å´„ÅîÈÖçÊÖÆ„Åè„Å†„Åï„ÅÑ<br>
                ‚Ä¢ „Ç§„É§„Éõ„É≥‰ΩøÁî®„ÇíÊé®Â•®„Åó„Åæ„Åô<br>
                ‚Ä¢ Èùô„Åã„Å™Â†¥ÊâÄ„Åß„ÅäÊ•Ω„Åó„Åø„Åè„Å†„Åï„ÅÑ
            </div>

            <h3>üìã ÂØæÂøú„Éá„Éê„Ç§„Çπ</h3>
            <div class="info-box">
                <strong>Êé®Â•®:</strong> iOS Safari„ÄÅAndroid Chrome<br>
                <strong>Âà∂Èôê:</strong> PC„Éñ„É©„Ç¶„Ç∂„Åß„ÅØ„Çª„É≥„Çµ„Éº„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì<br>
                <strong>„ÉÜ„Çπ„Éà:</strong> PC„Åß„ÅØ„Éû„Ç¶„ÇπÁßªÂãï„Åß„Ç∑„Éü„É•„É¨„Éº„ÉàÂèØËÉΩ
            </div>

            <h3>üîç „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±</h3>
            <p>„Éñ„É©„Ç¶„Ç∂„ÅÆÈñãÁô∫ËÄÖ„ÉÑ„Éº„É´ÔºàF12Ôºâ„ÅÆ„Ç≥„É≥„ÇΩ„Éº„É´„Åß‰ª•‰∏ã„ÅÆÊÉÖÂ†±„ÅåÁ¢∫Ë™ç„Åß„Åç„Åæ„ÅôÔºö</p>
            <ul>
                <li>„Çª„É≥„Çµ„ÉºÂÄ§„ÅÆ„É™„Ç¢„É´„Çø„Ç§„É†Ë°®Á§∫</li>
                <li>„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏</li>
                <li>Èü≥Â£∞Âá¶ÁêÜ„ÅÆÁä∂ÊÖã</li>
            </ul>
        </div>

        <!-- „Ç¢„Éó„É™Êú¨‰Ωì -->
        <div class="status-section">
            <div class="status-card">
                <h3>üì± „Éá„Éê„Ç§„ÇπÁä∂ÊÖã</h3>
                <div id="device-status" class="status-indicator">
                    <span class="status-text">„Çª„É≥„Çµ„Éº„ÇíÁ¢∫Ë™ç‰∏≠...</span>
                </div>
            </div>
        </div>

        <div class="control-section">
            <div class="control-card">
                <h3>üéº Èü≥Èöé„ÉªÈü≥Èáè</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="label">Èü≥Èöé:</span>
                        <span id="note-display" class="value">--</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Âë®Ê≥¢Êï∞:</span>
                        <span id="frequency-display" class="value">-- Hz</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Èü≥Èáè:</span>
                        <span id="volume-display" class="value">--</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="instruction-section">
            <div class="instruction-card">
                <h3>üéÆ Êìç‰ΩúÊñπÊ≥ï</h3>
                <div class="instructions">
                    <div class="instruction-item">
                        <span class="icon">‚ÜîÔ∏è</span>
                        <span class="text">Â∑¶Âè≥„Å´ÂÇæ„Åë„Çã ‚Üí Èü≥Èöé„ÅåÂ§â„Çè„Çä„Åæ„Åô</span>
                    </div>
                    <div class="instruction-item">
                        <span class="icon">‚ÜïÔ∏è</span>
                        <span class="text">ÂâçÂæå„Å´ÂÇæ„Åë„Çã ‚Üí Èü≥Èáè„ÅåÂ§â„Çè„Çä„Åæ„Åô</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="action-section">
            <button id="start-button" class="start-button">
                üéµ ÊºîÂ•èÈñãÂßã
            </button>
            <div id="permission-notice" class="permission-notice">
                <p>‚ö†Ô∏è Èü≥„ÅåÂá∫„Çã„ÅÆ„ÅßÂë®Âõ≤„Å´„ÅîÈÖçÊÖÆ„Åè„Å†„Åï„ÅÑ</p>
            </div>
        </div>

        <div class="sensor-section">
            <div class="sensor-card">
                <h3>üìä „Çª„É≥„Çµ„ÉºÂÄ§</h3>
                <div class="sensor-grid">
                    <div class="sensor-item">
                        <span class="sensor-label">Gamma (Â∑¶Âè≥):</span>
                        <span id="gamma-value" class="sensor-value">--¬∞</span>
                    </div>
                    <div class="sensor-item">
                        <span class="sensor-label">Beta (‰∏ä‰∏ã):</span>
                        <span id="beta-value" class="sensor-value">--¬∞</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class TiltHarmonica {
            constructor() {
                this.audioContext = null;
                this.oscillator = null;
                this.gainNode = null;
                this.isPlaying = false;
                this.isInitialized = false;
                
                // Èü≥ÈöéË®≠ÂÆöÔºàC4„ÄúC5Ôºâ
                this.notes = {
                    'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13,
                    'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00,
                    'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
                    'C5': 523.25
                };
                
                this.noteNames = Object.keys(this.notes);
                
                // „Çª„É≥„Çµ„ÉºÂÄ§„ÅÆÁØÑÂõ≤Ë®≠ÂÆö
                this.gammaRange = { min: -45, max: 45 }; // Â∑¶Âè≥ÂÇæ„Åç
                this.betaRange = { min: -30, max: 30 };  // ÂâçÂæåÂÇæ„Åç
                
                this.init();
            }
            
            async init() {
                this.updateDeviceStatus('ÂàùÊúüÂåñ‰∏≠...', 'loading');
                
                try {
                    // Web Audio APIÂàùÊúüÂåñ
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // „Çª„É≥„Çµ„Éº„Çµ„Éù„Éº„ÉàÁ¢∫Ë™ç
                    if (!window.DeviceOrientationEvent) {
                        throw new Error('„Éá„Éê„Ç§„Çπ„Çª„É≥„Çµ„Éº„Åå„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    }
                    
                    this.updateDeviceStatus('Ê∫ñÂÇôÂÆå‰∫ÜÔºÅ„Çø„ÉÉ„Éó„Åó„Å¶ÈñãÂßã', 'ready');
                    this.isInitialized = true;
                    
                } catch (error) {
                    console.error('ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                    this.updateDeviceStatus('„Ç®„É©„Éº: ' + error.message, 'error');
                }
            }
            
            updateDeviceStatus(message, status) {
                const statusElement = document.getElementById('device-status');
                const statusText = statusElement.querySelector('.status-text');
                
                statusText.textContent = message;
                statusElement.className = `status-indicator ${status}`;
            }
            
            startAudio() {
                if (!this.audioContext || this.isPlaying) return;
                
                try {
                    // AudioContext„ÇíresumeÔºàiOSÂØæÂøúÔºâ
                    if (this.audioContext.state === 'suspended') {
                        this.audioContext.resume();
                    }
                    
                    // „Ç™„Ç∑„É¨„Éº„Çø„Éº‰ΩúÊàê
                    this.oscillator = this.audioContext.createOscillator();
                    this.gainNode = this.audioContext.createGain();
                    
                    // ÂàùÊúüË®≠ÂÆö
                    this.oscillator.type = 'sine';
                    this.oscillator.frequency.setValueAtTime(440, this.audioContext.currentTime); // A4
                    this.gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                    
                    // Êé•Á∂ö
                    this.oscillator.connect(this.gainNode);
                    this.gainNode.connect(this.audioContext.destination);
                    
                    // ÈñãÂßã
                    this.oscillator.start();
                    this.isPlaying = true;
                    
                    // „Çª„É≥„Çµ„Éº„Ç§„Éô„É≥„ÉàÈñãÂßã
                    this.startSensorEvents();
                    
                    // UIÊõ¥Êñ∞
                    this.updateStartButton(true);
                    this.updateDeviceStatus('ÊºîÂ•è‰∏≠...', 'ready');
                    
                } catch (error) {
                    console.error('Èü≥Â£∞ÈñãÂßã„Ç®„É©„Éº:', error);
                    this.updateDeviceStatus('Èü≥Â£∞„Ç®„É©„Éº: ' + error.message, 'error');
                }
            }
            
            stopAudio() {
                if (!this.isPlaying) return;
                
                try {
                    // „Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà
                    this.gainNode.gain.setValueAtTime(this.gainNode.gain.value, this.audioContext.currentTime);
                    this.gainNode.gain.linearRampToValueAtTime(0, this.audioContext.currentTime + 0.1);
                    
                    setTimeout(() => {
                        if (this.oscillator) {
                            this.oscillator.stop();
                            this.oscillator = null;
                        }
                        this.gainNode = null;
                        this.isPlaying = false;
                        
                        // „Çª„É≥„Çµ„Éº„Ç§„Éô„É≥„ÉàÂÅúÊ≠¢
                        this.stopSensorEvents();
                        
                        // UIÊõ¥Êñ∞
                        this.updateStartButton(false);
                        this.updateDeviceStatus('Ê∫ñÂÇôÂÆå‰∫ÜÔºÅ„Çø„ÉÉ„Éó„Åó„Å¶ÈñãÂßã', 'ready');
                    }, 100);
                    
                } catch (error) {
                    console.error('Èü≥Â£∞ÂÅúÊ≠¢„Ç®„É©„Éº:', error);
                }
            }
            
            startSensorEvents() {
                window.addEventListener('deviceorientation', this.handleOrientation.bind(this));
            }
            
            stopSensorEvents() {
                window.removeEventListener('deviceorientation', this.handleOrientation.bind(this));
            }
            
            handleOrientation(event) {
                if (!this.isPlaying || !this.oscillator || !this.gainNode) return;
                
                const gamma = event.gamma; // Â∑¶Âè≥ÂÇæ„Åç (-180 to 180)
                const beta = event.beta;   // ÂâçÂæåÂÇæ„Åç (-180 to 180)
                
                // „Çª„É≥„Çµ„ÉºÂÄ§Ë°®Á§∫Êõ¥Êñ∞
                this.updateSensorDisplay(gamma, beta);
                
                // Èü≥ÈöéË®àÁÆóÔºàgamma‰ΩøÁî®Ôºâ
                const frequency = this.calculateFrequency(gamma);
                const noteName = this.getNoteName(frequency);
                
                // Èü≥ÈáèË®àÁÆóÔºàbeta‰ΩøÁî®Ôºâ
                const volume = this.calculateVolume(beta);
                
                // Èü≥Â£∞„Éë„É©„É°„Éº„ÇøÊõ¥Êñ∞
                this.updateAudioParameters(frequency, volume);
                
                // UIÊõ¥Êñ∞
                this.updateDisplay(noteName, frequency, volume);
            }
            
            calculateFrequency(gamma) {
                // gamma„ÇíÈü≥ÈöéÁØÑÂõ≤„Å´„Éû„ÉÉ„Éî„É≥„Ç∞
                const clampedGamma = Math.max(this.gammaRange.min, Math.min(this.gammaRange.max, gamma));
                const normalizedGamma = (clampedGamma - this.gammaRange.min) / (this.gammaRange.max - this.gammaRange.min);
                
                // Âë®Ê≥¢Êï∞ÁØÑÂõ≤: C4 (261.63Hz) „Äú C5 (523.25Hz)
                const minFreq = 261.63;
                const maxFreq = 523.25;
                
                return minFreq + (maxFreq - minFreq) * normalizedGamma;
            }
            
            calculateVolume(beta) {
                // beta„ÇíÈü≥ÈáèÁØÑÂõ≤„Å´„Éû„ÉÉ„Éî„É≥„Ç∞
                const clampedBeta = Math.max(this.betaRange.min, Math.min(this.betaRange.max, beta));
                const normalizedBeta = (clampedBeta - this.betaRange.min) / (this.betaRange.max - this.betaRange.min);
                
                // Èü≥ÈáèÁØÑÂõ≤: 0 „Äú 0.8ÔºàÊúÄÂ§ßÈü≥Èáè„ÅØÂ∞ë„ÅóÊäë„Åà„ÇãÔºâ
                return Math.max(0, Math.min(0.8, normalizedBeta));
            }
            
            getNoteName(frequency) {
                // ÊúÄ„ÇÇËøë„ÅÑÈü≥Èöé„ÇíÊé¢„Åô
                let closestNote = 'C4';
                let minDifference = Infinity;
                
                for (const [noteName, noteFreq] of Object.entries(this.notes)) {
                    const difference = Math.abs(frequency - noteFreq);
                    if (difference < minDifference) {
                        minDifference = difference;
                        closestNote = noteName;
                    }
                }
                
                return closestNote;
            }
            
            updateAudioParameters(frequency, volume) {
                if (!this.oscillator || !this.gainNode) return;
                
                const currentTime = this.audioContext.currentTime;
                
                // Âë®Ê≥¢Êï∞„ÇíÊªë„Çâ„Åã„Å´Â§âÊõ¥
                this.oscillator.frequency.setValueAtTime(frequency, currentTime);
                
                // Èü≥Èáè„ÇíÊªë„Çâ„Åã„Å´Â§âÊõ¥
                this.gainNode.gain.setValueAtTime(volume, currentTime);
            }
            
            updateDisplay(noteName, frequency, volume) {
                // Èü≥ÈöéË°®Á§∫
                document.getElementById('note-display').textContent = noteName;
                
                // Âë®Ê≥¢Êï∞Ë°®Á§∫
                document.getElementById('frequency-display').textContent = `${Math.round(frequency)} Hz`;
                
                // Èü≥ÈáèË°®Á§∫Ôºà„Éë„Éº„Çª„É≥„ÉÜ„Éº„Ç∏Ôºâ
                const volumePercent = Math.round(volume * 100);
                document.getElementById('volume-display').textContent = `${volumePercent}%`;
            }
            
            updateSensorDisplay(gamma, beta) {
                // „Çª„É≥„Çµ„ÉºÂÄ§Ë°®Á§∫
                document.getElementById('gamma-value').textContent = `${Math.round(gamma)}¬∞`;
                document.getElementById('beta-value').textContent = `${Math.round(beta)}¬∞`;
            }
            
            updateStartButton(isPlaying) {
                const button = document.getElementById('start-button');
                if (isPlaying) {
                    button.textContent = '‚èπÔ∏è ÊºîÂ•èÂÅúÊ≠¢';
                    button.classList.add('playing');
                } else {
                    button.textContent = 'üéµ ÊºîÂ•èÈñãÂßã';
                    button.classList.remove('playing');
                }
            }
        }

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            const app = new TiltHarmonica();
            
            // ÈñãÂßã„Éú„Çø„É≥„Ç§„Éô„É≥„Éà
            const startButton = document.getElementById('start-button');
            startButton.addEventListener('click', () => {
                if (!app.isInitialized) {
                    alert('„Ç¢„Éó„É™„ÅÆÂàùÊúüÂåñ„ÅåÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }
                
                if (app.isPlaying) {
                    app.stopAudio();
                } else {
                    app.startAudio();
                }
            });
            
            // „Éö„Éº„Ç∏Èõ¢ËÑ±ÊôÇ„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
            window.addEventListener('beforeunload', () => {
                if (app.isPlaying) {
                    app.stopAudio();
                }
            });
            
            // „Éö„Éº„Ç∏ÈùûË°®Á§∫ÊôÇ„ÅÆÈü≥Â£∞ÂÅúÊ≠¢
            document.addEventListener('visibilitychange', () => {
                if (document.hidden && app.isPlaying) {
                    app.stopAudio();
                }
            });
        });

        // „Éá„Éê„ÉÉ„Ç∞Áî®ÔºöPC„Åß„ÅÆ„ÉÜ„Çπ„ÉàÁî®
        if (!window.DeviceOrientationEvent) {
            console.log('„Éá„Éê„Ç§„Çπ„Çª„É≥„Çµ„Éº„Åå„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„É¢„Éê„Ç§„É´„Éá„Éê„Ç§„Çπ„Åß„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
            
            // PC„Åß„ÅÆ„ÉÜ„Çπ„ÉàÁî®Ôºà„Éû„Ç¶„ÇπÁßªÂãï„Åß„Ç∑„Éü„É•„É¨„Éº„ÉàÔºâ
            let isMouseSimulating = false;
            
            document.addEventListener('click', () => {
                if (!isMouseSimulating) {
                    isMouseSimulating = true;
                    console.log('„Éû„Ç¶„ÇπÁßªÂãï„Åß„Çª„É≥„Çµ„ÉºÂÄ§„Çí„Ç∑„Éü„É•„É¨„Éº„Éà„Åó„Åæ„ÅôÔºàPC„ÉÜ„Çπ„ÉàÁî®Ôºâ');
                }
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isMouseSimulating) {
                    // „Éû„Ç¶„Çπ‰ΩçÁΩÆ„Çí„Çª„É≥„Çµ„ÉºÂÄ§„Å´Â§âÊèõ
                    const gamma = (e.clientX / window.innerWidth) * 90 - 45;
                    const beta = (e.clientY / window.innerHeight) * 60 - 30;
                    
                    // „Ç§„Éô„É≥„Éà„Çí„Ç∑„Éü„É•„É¨„Éº„Éà
                    const event = new Event('deviceorientation');
                    event.gamma = gamma;
                    event.beta = beta;
                    
                    window.dispatchEvent(event);
                }
            });
        }
    </script>
</body>
</html> 